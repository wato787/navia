# TanStack Router & Query ?????

AI Shift ????TanStack Router?& Query??SPA????????????????????`apps/frontend` ??????????????????

## ??????

```bash
bun add --cwd apps/frontend \
  @tanstack/react-router @tanstack/router-devtools \
  @tanstack/react-query @tanstack/router-vite-plugin
```

- `vite.config.ts` ?? `TanStackRouterVite({ routesDirectory: "./src/routes" })` ??????????????????????????
- QueryClient ? `router.ts` ?????Router ? Context ? React Query Provider ??????????

## ????????

```
apps/frontend/src/
  routes/
    __root.tsx
    home/
      -components/
      -functions/
      -api/
      -types/
      route.tsx
      route.lazy.tsx
    about/
      ...??
  router.ts
  routeTree.gen.ts
```

????????????? layer ???? feature ????????????`-components/-api/-types/-functions` ?????????????????????

## ??????

- `__root.tsx` ? `createRootRouteWithContext` ?????????? Devtools ????
- ????? `route.tsx` ?? `createFileRoute` ??????????????
  - `validateSearch` ? search params ???????
  - `loaderDeps` ? `loader` ? QueryClient ??? preload ???
  - `pendingComponent` / `errorComponent` ????????
  - `React.lazy` ???? `route.lazy.tsx` ????? UI ?????

```20:40:apps/frontend/src/routes/home/route.tsx
export const Route = createFileRoute("/")({
  validateSearch: (search: Record<string, unknown>) => ({
    audience: parseAudience(search.audience)
  }),
  loaderDeps: ({ search }) => ({
    audience: search.audience as Audience
  }),
  loader: async ({ context, deps }) => {
    await context.queryClient.ensureQueryData(homeQueryOptions(deps.audience));
    return { audience: deps.audience };
  },
  pendingComponent: PendingState,
  errorComponent: ({ error }) => <ErrorState message={error.message ?? "Unknown error"} />,
  component: () => (
    <Suspense fallback={<PendingState />}>
      <HomeRouteComponent />
    </Suspense>
  )
});
```

```1:56:apps/frontend/src/routes/home/route.lazy.tsx
export function HomeRoute() {
  const navigate = useNavigate({ from: "/" });
  const search = Route.useSearch();
  const loaderData = Route.useLoaderData();

  const activeAudience = loaderData.audience;
  const { data } = useSuspenseQuery(homeQueryOptions(activeAudience));

  return (
    <div style={{ display: "grid", gap: "1.5rem" }}>
      ...
    </div>
  );
}
```

## Search Params ??????

- Home ???? `audience`?About ???? `focus` ? search params ???????URL ?????????????
- `loaderDeps` ???????????????????????? SWR ??????????????

## React Query ??

- `router.ts` ????? QueryClient ? Router context ????`ensureQueryData` ?????? ? `useSuspenseQuery` ?????????????????
- ???????????????Suspense + ErrorBoundary ????????????????????

```5:22:apps/frontend/src/router.ts
export const queryClient = new QueryClient();

export const router = createRouter({
  routeTree,
  context: {
    queryClient
  },
  defaultPreload: "intent"
});
```

## Devtools

- `__root.tsx` ? `TanStackRouterDevtools` ???????`import.meta.env.PROD` ??????????
- React Query Devtools ??????? `App.tsx` ????????

## TODO ?????

- pages ??????????????????????????
- loader / validateSearch / Suspense ?????????
- TanStack Query ????? Search Params ???????????????????????????

## ????

- [TanStack Router for React](https://tanstack.com/router/latest/docs/framework/react/overview)
- [TanStack Query Documentation](https://tanstack.com/query/latest)
- [TanStack Router?& Query??SPA??????????????](https://zenn.dev/aishift/articles/ad1744836509dd)
