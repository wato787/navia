import type { Location } from "@/types/location";
import { BACKEND_API_URL } from "@/pages/const";

/**
 * ??????????????
 * ????????????????
 */

/**
 * ??????????????
 */
export interface GeocodeParams {
  address: string;
}

/**
 * ??????API???????
 */
interface GeocodeResponse {
  data: {
    lat: number;
    lng: number;
  };
}

/**
 * ??????????????
 */
export const GeocodeUsecase = {
  /**
   * ?????????
   * @param params ?????????????
   * @returns ????????
   * @throws ???????????????
   */
  async geocode(params: GeocodeParams): Promise<Location> {
    const { address } = params;
    const queryParams = new URLSearchParams({ address });

    const response = await fetch(
      `${BACKEND_API_URL}/api/places/geocode?${queryParams.toString()}`,
    );

    if (!response.ok) {
      const error = await response.json();
      console.error("Geocode API error:", error);
      throw new Error(
        `???????????????: ${response.statusText}`,
      );
    }

    const result: GeocodeResponse = await response.json();

    if (!result.data?.lat || !result.data?.lng) {
      throw new Error("?????????????");
    }

    return {
      lat: result.data.lat,
      lng: result.data.lng,
    };
  },
};
